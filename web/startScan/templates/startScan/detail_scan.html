{% extends 'base/base.html' %}
{% load static %}
{% load humanize %}
{% load custom_tags %}
{% block title %}
Detailed Scan
{% endblock title %}

{% block custom_js_css_link %}
<link rel="stylesheet" type="text/css" href="{% static 'plugins/table/datatable/datatables.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'assets/css/forms/theme-checkbox-radio.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'plugins/table/datatable/dt-global_style.css' %}">
<link href="{% static 'assets/css/dashboard/dash_1.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'assets/css/components/custom-modal.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'assets/css/elements/custom-tree_view.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'plugins/lightbox/css/lightbox.css' %}" rel="stylesheet" />
<link href="{% static 'plugins/apex/apexcharts.css' %}" rel="stylesheet" type="text/css">
<link href="{% static 'assets/css/components/tabs-accordian/custom-accordions.css' %}" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="{% static 'assets/css/elements/search.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'assets/css/elements/alert.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'assets/css/forms/theme-checkbox-radio.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'plugins/loaders/custom-loader.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'plugins/select2/select2.min.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'plugins/gridzy/gridzy.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'plugins/gridzy/skins/gridzySkinBlank/style.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'plugins/mitchtree/css/d3-mitch-tree.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'plugins/mitchtree/css/d3-mitch-tree-theme-default.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'assets/css/widgets/modules-widgets.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'assets/css/forms/theme-checkbox-radio.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'assets/css/apps/todolist.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'assets/css/custom.css' %}">
<link href="{% static 'plugins/sweetalerts/sweetalert2.min.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'plugins/sweetalerts/sweetalert.css' %}" rel="stylesheet" type="text/css" />
<script src="https://cdn.jsdelivr.net/gh/deltoss/d3-mitch-tree@1.0.2/dist/js/d3-mitch-tree.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
<script src="{% static 'plugins/gridzy/gridzy.js' %}"></script>
{% endblock custom_js_css_link %}

{% block breadcrumb_title %}
<li class="breadcrumb-item"><a href="{% url 'scan_history' %}">Scan History</a></li>
<li class="breadcrumb-item active">Summary</li>
<li class="breadcrumb-item active" aria-current="page">{{history.domain.name}}</li>
{% endblock breadcrumb_title %}
{% block main_content %}
<!-- Activity Feed -->
<!-- nav menu and contents -->
<div class="row">
	<div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
		<div class="simple-pills">
			<ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
				<li class="nav-item">
					<a class="nav-link active" id="pills-summary-tab" data-toggle="pill" href="#pills-summary" role="tab" aria-controls="pills-summary" aria-selected="true">Home</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" id="pills-subdomain-tab" data-toggle="pill" href="#pills-subdomain" role="tab" aria-controls="pills-subdomain" aria-selected="false">Subdomains</a>
				</li>
				{% if history.screenshot %}
				<li class="nav-item">
					<a class="nav-link" id="pills-screenshot-tab" data-toggle="pill" href="#pills-screenshot" role="tab" aria-controls="pills-screenshot" aria-selected="false">Screenshots</a>
				</li>
				{% endif %}
				{% if history.dir_file_search %}
				<li class="nav-item">
					<a class="nav-link" id="pills-directories-tab" data-toggle="pill" href="#pills-directories" role="tab" aria-controls="pills-directories" aria-selected="false">Directories</a>
				</li>
				{% endif %}
				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
						URLs
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down">
							<polyline points="6 9 12 15 18 9"></polyline>
						</svg>
					</a>
					<div class="dropdown-menu">
						<a class="dropdown-item" id="pills-endpoints-tab" data-toggle="tab" href="#pills-endpoints" role="tab" aria-controls="pills-endpoints" aria-selected="false">All Endpoints</a>
						{% if history.fetch_url and history.used_gf_patterns%}
						{% for key,value in matched_gf_count.items %}
						{% if value > 0 %}
						<a class="dropdown-item" id="pills-{{key}}-tab" data-toggle="tab" href="#pills-endpoints" role="tab" aria-controls="pills-endpoints" aria-selected="false">{{key|upper}}&nbsp;&nbsp;<span class="badge badge-pills badge-danger">{{value}}</span></a>
						{% endif %}
						{% endfor %}
						{% endif %}
					</div>
				</li>
				{% if history.vulnerability_scan %}
				<li class="nav-item">
					<a class="nav-link" id="pills-vulnerabilities-tab" data-toggle="pill" href="#pills-vulnerabilities" role="tab" aria-controls="pills-vulnerabilities" aria-selected="false">Vulnerabilities</a>
				</li>
				{% endif %}
				{% if history.osint %}
				<li class="nav-item">
					<a class="nav-link" id="pills-osint-tab" data-toggle="pill" href="#pills-osint" role="tab" aria-controls="pills-osint" aria-selected="false">OSINT</a>
				</li>
				{% endif %}
				<li class="nav-item">
					<a class="nav-link" id="pills-visualisation-tab" data-toggle="pill" href="#pills-visualisation" role="tab" aria-controls="pills-visualisation" aria-selected="false">Visualization</a>
				</li>
			</ul>
			<div class="tab-content" id="pills-tabContent">
				<div class="tab-pane fade show active" id="pills-summary" role="tabpanel" aria-labelledby="pills-summary-tab">
					<div class="row">
						<div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 layout-spacing">
							<div class="widget widget-one">
								<div class="w-chart">
									<div class="w-chart-section primary-card">
										<div class="w-detail">
											<p class="w-stats">{{subdomain_count|intcomma}}
												<span class="float-right">
												</span>
											</p>
											<p class="w-title">Subdomains Discovered</p>
											<p class="w-title text-success">{{alive_count}} Alive Subdomains</p>
											<p class="w-title text-danger">{{important_count}} Subdomains marked as Important</p>
											<br>
										</div>
									</div>
									<div class="w-chart-section purple-card">
										<div class="w-detail">
											<p class="w-stats">{{endpoint_count|intcomma}}
												<span class="float-right">
													<span class="badge badge-pills badge-success bs-tooltip m-1" id="added_endpoint_badge"></span>
													<span class="badge badge-pills badge-danger bs-tooltip m-1" id="removed_endpoint_badge"></span>
												</span>
											</p>
											<p class="w-title">Endpoints Discovered</p>
											<p class="w-title text-success">{{endpoint_alive_count}} Alive Endpoints</p>
											<br>
											<br>
										</div>
									</div>
									<div class="w-chart-section danger-card">
										<div class="w-detail">
											<p class="w-stats">{{total_vulnerability_count|intcomma}}
												<span class="float-right">
												</span>
											</p>
											<p class="w-title">Vulnerabilities Discovered</p>
											{% if history.vulnerability_scan %}
											<p class="w-title text-danger">{{critical_count}} Critical, {{high_count}} High, {{medium_count}} Medium</p>
											<p class="w-title text-warning">and {{low_count}} Low Vulnerabilities</p>
											{% else %}
											<p class="text-muted">Vulnerability scan hasn't been performed.<br>
												Please perform vulnerability scan to discover vulnerabilities.</p>
												{% endif %}
											</div>
										</div>
										<div class="w-chart-section info-card">
											<div class="w-detail">
												<p class="w-stats">OSINT
													<span class="float-right">
													</span>
												</p>
												{% if history.osint %}
												{% if exposed_count %}
												<p class="w-title">{{exposed_count}} Exposed Credentials</p>
												{% endif %}
												{% if email_count %}
												<p class="w-title text-muted">{{email_count}} Email Address Discovered</p>
												{% endif %}
												{% if employees_count %}
												<p class="w-title text-muted">{{employees_count}} Employees Found</p>
												{% endif %}
												<br>
												{% else %}
												<p class="text-muted">OSINT hasn't been performed.</p>
												{% endif %}
											</div>
										</div>
									</div>
									<br>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-xl-4 col-lg-6 col-md-6 col-sm-12 col-12 layout-spacing">
								<div class="widget widget-five widget-progress">
									<div class="widget-heading">
										<a href="javascript:void(0)" class="task-info">
											<div class="usr-avatar">
												<span>{{history.domain.name|slice:"0:2"|upper}}</span>
											</div>
											<div class="w-title">
												<h6>Scan Information for <span class="badge badge-pills badge-dark">{{history.domain.name}}</span>
												</h6>
											</div>
										</a>
										<div class="task-action">
											<div class="dropdown">
												<a class="dropdown-toggle" href="#" role="button" id="pendingTask" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
													<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-horizontal text-dark"><circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle><circle cx="5" cy="12" r="1"></circle></svg>
												</a>
												<div class="dropdown-menu dropdown-menu-right" aria-labelledby="pendingTask" style="will-change: transform;">
													<a class="dropdown-item" href="javascript:download_subdomains({{scan_history_id}}, '{{history.domain.name}}')">Download All Subdomains</a>
													<a class="dropdown-item" href="javascript:download_endpoints({{scan_history_id}}, '{{history.domain.name}}')">Download All Endpoints</a>
													<a class="dropdown-item" href="javascript:download_important_subdomains({{scan_history_id}}, '{{history.domain.name}}');">Download Important Subdomains</a>
													<a class="dropdown-item" href="javascript:download_interesting_subdomains({{scan_history_id}}, '{{history.domain.name}}');">Download Interesting Subdomains</a>
												</div>
											</div>
										</div>
									</div>
									<div class="widget-content">
										<div class="row">
											<div class="col-3">
												<h6 class="text-center">Scan Engine</h6>
												<div class="text-center">
													<span class="badge badge-info">{{history.scan_type.engine_name}}</span>
												</div>
											</div>
											<div class="col-5">
												<h6 class="text-center">Scan Status</h6>
												<div class="text-center">
													{% if history.scan_status == -1 %}
													<h6 class="badge badge-warning">Pending</h6>
													{% elif history.scan_status == 0 %}
													<h6 class="badge badge-danger">Failed</h6>
													{% elif history.scan_status == 1 %}
													<h6 class="badge badge-info">In Progress</h6> <small class="text-info"> >> {{scan_activity.0}}</small>
													{% elif history.scan_status == 2 %}
													<h6 class="badge badge-success">Completed</h6>
													{% elif history.scan_status == 3 %}
													<h6 class="badge badge-danger">Aborted</h6>
													{% else %}
													<h6 class="badge badge-danger">Unknown</h6>
													{% endif %}
												</div>
											</div>
											<div class="col-4">
												<h6 class="text-center">Scan Duration</h6>
												{% if history.scan_status == -1 %}
												<p class="text-center"><small class="text-center text-muted">Scan not yet started.</small></p>
												{% elif history.scan_status == 0 %}
												<h6 class="text-center text-danger">{{ history.start_scan_date|timesince:history.stop_scan_date }}</h6>
												{% elif history.scan_status == 1 %}
												<h6 class="text-center text-info">{{ history.get_elapsed_time }}</h6>
												{% elif history.scan_status == 2 %}
												{% if history.get_completed_time_in_sec < 60 %}
												<h6 class="text-center text-success">Completed in < 1 minutes</h6>
												{% else %}
												<h6 class="text-center text-success">Completed in {{ history.start_scan_date|timesince:history.stop_scan_date }}</h6>
												{% endif %}
												{% elif history.scan_status == 3 %}
												<h6 class="text-center text-danger">Aborted in {{ history.start_scan_date|timesince:history.stop_scan_date }}</h6>
												{% endif %}
											</div>
										</div>
										<div class="progress-data">
											<div class="progress">
												{% if history.scan_status == -1 %}
												<div class="progress-bar bg-gradient-warning" role="progressbar" style="width: 10%" aria-valuemin="0" aria-valuemax="100">
												</div>
												{% elif history.scan_status == 0 %}
												<div class="progress-bar bg-gradient-danger" role="progressbar" style="width: {% widthratio history.scanactivity_set.all|length history.scan_type.get_number_of_steps|add:4  100 %}%" aria-valuemin="0" aria-valuemax="4">
												</div>
												{% elif history.scan_status == 1 %}
												<div class="progress-bar bg-gradient-info" role="progressbar" style="width: {% widthratio history.scanactivity_set.all|length history.scan_type.get_number_of_steps|add:4  100 %}%" aria-valuemin="0" aria-valuemax="4">
												</div>
												{% elif history.scan_status == 2 %}
												<div class="progress-bar bg-gradient-success" role="progressbar" style="width: 100%" aria-valuemin="0" aria-valuemax="100">
												</div>
												{% elif history.scan_status == 3 %}
												<div class="progress-bar bg-gradient-danger" role="progressbar" style="width: {% widthratio history.scanactivity_set.all|length history.scan_type.get_number_of_steps|add:4  100 %}%" aria-valuemin="0" aria-valuemax="4">
												</div>
												{% else %}
												<div class="progress">
													<div class="progress-bar bg-gradient-danger" role="progressbar" style="width: 100%" aria-valuemin="0" aria-valuemax="100">
													</div>
												</div>
												{% endif %}
											</div>
										</div>
										{% if  history.domain.get_organization %}
										Tagged to organization:
										{% endif %}
										{% for organization in history.domain.get_organization %}
										<span class="badge badge-pills outline-badge-dark m-1 bs-tooltip" title="Domain {{domain.name}} belongs to organization {{organization.name}}">{{ organization.name }}</span>
										{% endfor %}
										<a class="float-right text-info" href="{% url 'target_summary' history.domain.id %}" target="_blank">View Target Summary</a>
									</div>
								</div>
							</div>
							<div class="col-xl-4 col-lg-6 col-md-6 col-sm-12 col-12 layout-spacing">
								<div class="widget widget-timelime-scanactivity">
									<div class="widget-heading">
										<h6 class="">Scan Timeline</h6>
										<hr>
									</div>
									<div class="widget-content">
										<div class="w-shadow-top"></div>
										<div class="mt-container mx-auto">
											<div class="timeline-line">
												{% for activity in scan_activity %}
												<div class="item-timeline {% if activity.status == 0 %}timeline-danger {% elif activity.status == 1 %}timeline-warning{% elif activity.status == 2 %}timeline-success{% endif %}">
													<div class="t-dot" data-original-title="" title="">
													</div>
													<div class="t-text">
														<p>{{activity.title}}{% if activity.status == 1 %}<span class="badge badge-warning">In Progress</span>{% endif %}</p>
														<span class="badge {% if activity.status == 0 %}badge-danger {% elif activity.status == 1 %}badge-warning{% elif activity.status == 2 %}badge-success{% endif %}">
															{% if activity.status == 0 %}&nbsp;Failed&nbsp;
															{% elif activity.status == 1 %}&nbsp;In progress&nbsp;
															{% elif activity.status == 2 %}&nbsp;Completed&nbsp;
															{% endif %}
														</span>
														<p class="t-time">{{activity.time|naturaltime}}</p>
													</div>
												</div>
												{% endfor %}
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-xl-4 col-lg-6 col-md-6 col-sm-12 col-12 layout-spacing">
								<div class="widget widget-timeline-log">
									<div class="widget-heading">
										<h6 class="">Recent Scans</h6>
									</div>
									<div class="widget-content">
										<div class="w-shadow-top"></div>
										<div class="mt-container mx-auto">
											<div class="timeline-line">
												{% for scan in most_recent_scans %}
												<div class="item-timeline timeline-new">
													<div class="t-dot">
														{% if scan.scan_status == -1 %}
														<div class="t-warning"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-loader"><line x1="12" y1="2" x2="12" y2="6"></line><line x1="12" y1="18" x2="12" y2="22"></line><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line><line x1="2" y1="12" x2="6" y2="12"></line><line x1="18" y1="12" x2="22" y2="12"></line><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line></svg></div>
														{% elif scan.scan_status == 0 %}
														<div class="t-danger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div>
														{% elif scan.scan_status == 1 %}
														<div class="t-primary"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-activity"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg></div>
														{% elif scan.scan_status == 2 %}
														<div class="t-success"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check"><polyline points="20 6 9 17 4 12"></polyline></svg></div>
														{% elif scan.scan_status == 3 %}
														<div class="t-danger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div>
														{% else %}
														<div class="t-danger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div>
														{% endif %}
													</div>
													<div class="t-content">
														{% if history.id == scan.id %}
														<a href="#">
															{% else %}
															<a href="{% url 'detail_scan' scan.id %}">
																{% endif %}
																<div class="t-uppercontent">
																	<h5>
																		{% if history.id == scan.id %}
																		<span class="badge outline-badge-primary text-primary">Current Scan</span>
																		{% endif %}{{scan.start_scan_date|naturaltime}} :
																		{% if scan.scan_status == -1 %}
																		<span class="text-warning">[Pending]</span>
																		{% elif scan.scan_status == 0 %}
																		<span class="text-danger">[Failed]</span>
																		{% elif scan.scan_status == 1 %}
																		<span class="text-info">[Scanning]</span>
																		{% elif scan.scan_status == 2 %}
																		<span class="text-success">[Completed]</span>
																		{% elif scan.scan_status == 3 %}
																		<span class="text-danger">[Aborted]</span>
																		{% else %}
																		<span class="text-danger">[Unknown]</span>
																		{% endif %}
																	</h5>
																</div>
																<p>Scan Engine: {{scan.scan_type.engine_name}}</p>
																<p class="text-primary"><b>{{scan.get_subdomain_count}}</b> Subdomains Discovered</p>
															</div>
															{% if history.id == scan.id %}
														</a>
														{% else %}
													</a>
													{% endif %}
												</div>
												{% endfor %}
											</div>
										</div>
										<div class="w-shadow-bottom"></div>
									</div>
								</div>
							</div>
							<div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12 layout-spacing">
								<div class="widget widget-timeline-log">
									<div class="widget-heading">
										<h6 class="">
											<span id="important-count"><span class="spinner-border text-dark align-self-center loader-sm"></span></span>
											Important Subdomains
										</h6>
									</div>
									<div class="widget-content">
										<div class="w-shadow-top"></div>
										<div class="mt-container mx-auto">
											<div id="important-subdomains-list">

											</div>
										</div>
										<div class="w-shadow-bottom"></div>
									</div>
								</div>
							</div>
							<div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12 layout-spacing">
								<div class="widget widget-timeline-log">
									<div class="widget-heading">
										<h6 class="">
											<span id="tasks-count"><span class="spinner-border text-dark align-self-center loader-sm"></span></span>
											Recon Note/Todo
											<span class="text-info float-right bs-tooltip" title="Add Recon Todo" onclick="add_todo_for_scanhistory_modal({{history.id}})">
												<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
											</span>
										</h6>
									</div>
									<div class="modal fade" id="addTaskModal" tabindex="-1" role="dialog" aria-labelledby="addTaskModalTitle" aria-hidden="true">
										<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
											<div class="modal-content">
												<div class="modal-body">
													<div class="compose-box">
														<div class="compose-content" id="addTaskModalTitle">
															<h5 class="">Add Recon Todo</h5>
															<form>
																<input type="hidden" name="summary_identifier" value="{{history.id}}" id="summary_identifier_val">
																<div class="row">
																	<div class="col-md-12">
																		<div class="d-flex mail-to mb-4">
																			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-3 flaticon-notes"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>
																			<div class="w-100">
																				<input id="todoTitle" type="text" placeholder="Todo Title" class="form-control" name="task">
																			</div>
																		</div>
																	</div>
																</div>

																<div class="row">
																	<div class="col-md-12">
																		<div class="d-flex mail-to mb-4">
																			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-crosshair"><circle cx="12" cy="12" r="10"></circle><line x1="22" y1="12" x2="18" y2="12"></line><line x1="6" y1="12" x2="2" y2="12"></line><line x1="12" y1="6" x2="12" y2="2"></line><line x1="12" y1="22" x2="12" y2="18"></line></svg>
																			<div class="w-100">
																				Select Subdomain (Optional)
																				<br>
																				<span id="selectedSubdomainCount"></span>
																				<select class="placeholder js-states form-control" id="todoSubdomainDropdown">
																					<option>Choose Subdomain...</option>
																				</select>
																			</div>
																		</div>
																	</div>
																</div>

																<div class="d-flex  mail-subject mb-4">
																	<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text flaticon-menu-list"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
																	<div class="w-100">
																		<textarea class="form-control" id="todoDescription" rows="5" spellcheck="false" placeholder="Recon Todo/Note"></textarea>
																	</div>
																</div>
															</form>
														</div>
													</div>
												</div>
												<div class="modal-footer">
													<button class="btn btn-primary add-scan-history-todo">Add Recon Todo</button>
												</div>
											</div>
										</div>
									</div>
									<div class="widget-content">
										<div class="w-shadow-top"></div>
										<div class="mt-container mx-auto">
											<div id="recon-task-list">
											</div>
										</div>
										<div class="w-shadow-bottom"></div>
									</div>
								</div>
							</div>
							<div class="col-xl-4 col-lg-6 col-md-6 col-sm-12 col-12 layout-spacing">
								<div class="widget widget-ip">
									<div class="widget-heading">
										<h6 class=""><span id="ip-address-count"><span class="spinner-border text-dark align-self-center loader-sm"></span></span> IP Addresses <small id="ip-address-summary"></small></h6>
										<small class="text-warning">*IP Addresses highlighted with yellow are CDN IP</small>
									</div>
									<div class="widget-content">
										<div class="mt-container mx-auto">
											<div id="ip-address">
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-xl-4 col-lg-6 col-md-6 col-sm-12 col-12 layout-spacing">
								<div class="widget widget-ip">
									<div class="widget-heading">
										<h6 class=""><span id="ports-count"><span class="spinner-border text-dark align-self-center loader-sm"></span></span> Discovered Ports </h6>
										<small class="text-danger">*Ports highlighted with red are uncommon Ports.</small>
									</div>
									<div class="widget-content">
										<div class="mt-container mx-auto">
											<div id="ports">
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-xl-4 col-lg-6 col-md-6 col-sm-12 col-12 layout-spacing">
								<div class="widget widget-ip">
									<div class="widget-heading">
										<h6 class=""><span id="technologies-count"><span class="spinner-border text-dark align-self-center loader-sm"></span></span> Discovered Technologies </h6>
									</div>
									<div class="widget-content">
										<div class="mt-container mx-auto">
											<div id="technologies">
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						{% if history.osint %}
						<div class="row">
							<div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 layout-spacing">
								<div class="widget widget-ip">
									<div class="widget-heading">
										<h6 class=""><span id="dork-category-count"><span class="spinner-border text-dark align-self-center loader-sm"></span></span> Dork Categories </h6>
									</div>
									<div class="widget-content">
										<div class="mt-container mx-auto">
											<div id="osint-dork">
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						{% endif %}
						{% if history.vulnerability_scan %}
						<div class="row">
							<div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 layout-spacing">
								<div class="widget widget-activity-four">
									<div class="widget-heading">
										<h6 class="">Vulnerability Scan Summary</h6>
									</div>
									<div class="widget-content">
										<div class="row">
											<div class="col-xl-5 col-lg-5 col-md-12 col-sm-12 col-12">
												<div id="vulnerability-chart" class=""></div>
											</div>
											<div class="col-xl-7 col-lg-7 col-md-12 col-sm-12 col-12">
												<div class="table-responsive mt-container mx-auto">
													<table class="table">
														<thead>
															<tr>
																<th><div class="th-content">Vulnerability</div></th>
																<th><div class="th-content">Severity</div></th>
																<th><div class="th-content">Vulnerable URL</div></th>
															</tr>
														</thead>
														<tbody>
															{% for vulnerability in vulnerability_list  %}
															<tr>
																<td>{{vulnerability.name}}</td>
																<td>{% if vulnerability.severity == 0 %}
																	<span class='badge badge-info'>Info</span>
																	{% elif vulnerability.severity == 1 %}
																	<span class='badge badge-low'>Low</span>
																	{% elif vulnerability.severity == 2 %}
																	<span class='badge badge-warning'>Medium</span>
																	{% elif vulnerability.severity == 3 %}
																	<span class='badge badge-danger'>High</span>
																	{% elif vulnerability.severity == 4 %}
																	<span class='badge badge-critical'>Critical</span>
																	{% endif %}</td>
																	<td><a href="{{vulnerability.http_url}}" target="_blank" class="text-danger bs-tooltip" title="{{vulnerability.http_url}}">{{vulnerability.http_url|truncatechars:50}}</a></td>
																</tr>
																{% endfor %}
															</tbody>
														</table>
													</div>
													<small class="text-muted float-right">*Vulnerability list sorted by severity</small>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							{% endif %}
							<div class="row">
								<div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 layout-spacing">
									{% include 'base/_items/interesting_recon.html' %}
								</div>
							</div>
							<div class="row">
								<div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 layout-spacing" id="subdomain-changes-div">
									<div class="widget widget-table-two">
										<div class="widget-heading">
											<h6 class="">
												<div class="spinner-border text-danger align-self-center loader-sm" id="subdomain-changes-loader">Loading...</div>
												<span class="badge outline-badge-danger" id="subdomain_change_count"></span>&nbsp;&nbsp;Subdomain Changes
											</h6>
											<p class='text-muted'>Comparing against the scan performed on <a href="{{last_scan.id}}" class="badge badge-pills badge-info bs-tooltip" title="{{last_scan.get_subdomain_count}} subdomains were discovered during the last scan, while this scan discovered {{history.get_subdomain_count}} Subdomains"><small>{{last_scan.start_scan_date}}</small></a></p>
											<p class='text-muted'>During this scan
												<span class="badge badge-success badge-pills m-1" id="subdomain-added-count"></span>
												<span class="badge badge-danger badge-pills m-1" id="subdomain-removed-count"></span>
											</p>
										</div>
										<div class="widget-content">
											<div class="table-responsive">
												<table class="table" id="table-subdomain-changes">
													<thead>
														<tr>
															<th><div class="th-content">Subdomain</div></th>
															<th><div class="th-content">Page Title</div></th>
															<th><div class="th-content">Status</div></th>
															<th><div class="th-content">Content Length</div></th>
															<th><div class="th-content">Change</div></th>
														</tr>
													</thead>
												</table>
											</div>
										</div>
									</div>
								</div>
								<div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 layout-spacing" id="endpoint-changes-div">
									<div class="widget widget-table-two">
										<div class="widget-heading">
											<h6 class="">
												<div class="spinner-border text-danger align-self-center loader-sm" id="endpoint-changes-loader">Loading...</div>
												<span class="badge outline-badge-danger" id="endpoint_change_count"></span>&nbsp;&nbsp;Endpoint Changes
											</h6>
											<p class='text-muted'>Comparing against the scan performed on <a href="{{last_scan.id}}" class="badge badge-pills badge-info bs-tooltip" title="{{last_scan.get_endpoint_count}} endpoints were discovered during the last scan, while this scan discovered {{history.get_endpoint_count}} Endpoints."><small>{{last_scan.start_scan_date}}</small></a></p>
											<p class='text-muted'>During this scan
												<span class="badge badge-success badge-pills m-1" id="endpoint-added-count"></span>
												<span class="badge badge-danger badge-pills m-1" id="endpoint-removed-count"></span>
											</p>
										</div>
										<div class="widget-content">
											<div class="table-responsive">
												<table class="table" id="table-endpoint-changes">
													<thead>
														<tr>
															<th><div class="th-content">URL</div></th>
															<th><div class="th-content">Page Title</div></th>
															<th><div class="th-content">Status</div></th>
															<th><div class="th-content">Content Length</div></th>
															<th><div class="th-content">Change</div></th>
														</tr>
													</thead>
												</table>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="tab-pane fade" id="pills-subdomain" role="tabpanel" aria-labelledby="pills-subdomain-tab">
							<div class="row justify-content-center">
								<div class="col-xl-8 col-lg-8 col-sm-8">
									<div class="wrapper">
										<div class="search-input">
											<a href="" target="_blank" hidden></a>
											<div class="input-group">
												<input type="text" class="form-control" placeholder="Filter Subdomains" aria-label="Filter Subdomains" id="subdomains-search">
												<div class="input-group-append">
													<button id="subdomain-search-button" class="btn btn-primary" type="button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg> Search</button>
												</div>
											</div>
											<div class="autocom-box mt-container mx-auto" id="autocom-box">
											</div>
										</div>
									</div>
								</div>
								<div class="col-xl-12 col-lg-12 col-sm-12">
									<div class="widget widget-content widget-content-area">
										<div class="row">
											<div class="col-12">
												<div class="task-action float-right mb-4">
													<div class="dropdown">
														<a class="dropdown-toggle bs-tooltip" title="Download Results" href="#" role="button" id="pendingTask" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
															<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-download"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
														</a>
														<div class="dropdown-menu dropdown-menu-right" aria-labelledby="pendingTask" style="will-change: transform;">
															<a class="dropdown-item" href="javascript:download_subdomains({{scan_history_id}}, '{{history.domain.name}}')">Download All Subdomains</a>
															<a class="dropdown-item" href="javascript:download_interesting_subdomains({{scan_history_id}}, '{{history.domain.name}}');">Download Interesting Subdomains</a>
															<a class="dropdown-item" href="javascript:download_important_subdomains({{scan_history_id}}, '{{history.domain.name}}');">Download Important Subdomains</a>
														</div>
													</div>
												</div>
											</div>
											<div class="col-12">
												<table id="subdomain_scan_results" class="table dt-table-hover" style="width:100%">
													<thead>
														<tr>
															<th class="checkbox-column">Status</th>
															<th>Subdomain</th>
															<th class="text-center">Endpoints</th>
															<th class="text-center">Vulnerabilities</th>
															<th>Status</th>
															<th class="text-center">Title</th>
															<th>IP Address</th>
															<th>Ports</th>
															<th>Content Length</th>
															<th>Screenshot</th>
															<th>Response Time</th>
															<th>Technology</th>
															<th>Checked</th>
															<th>HTTP URL</th>
															<th>CNAME</th>
															<th>is_interesting</th>
															<th>Info</th>
															<th>Low</th>
															<th>Medium</th>
															<th>High</th>
															<th>Critical</th>
															<th>Todos</th>
															<th>Is Important</th>
															<th>Webserver</th>
															<th>Content Type</th>
														</tr>
													</thead>
												</table>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						{% if history.screenshot %}
						<div class="tab-pane fade" id="pills-screenshot" role="tabpanel" aria-labelledby="pills-screenshot-tab">
							<div class="col-lg-8 col-md-8 col-sm-9 filtered-list-search mx-auto">
								<div class="w-100">
									<input type="text" class="w-100 form-control product-search br-30" id="screenshot-search" placeholder="">
								</div>
							</div>
							<div class="col-xl-12 col-lg-12 col-sm-12" id="screenshot-div">
								<div class="widget widget-content widget-content-area br-6">
									<div class="row">
										<div class="col-xl-12 col-lg-12 col-sm-12">
											<div class="outer-div" id="screenshot-loader">
												<div class="spinner-border text-info align-self-center inner-div">Loading...</div>
												<br>
												<h5 class="text-center mt-3">Loading Screenshots...</h5>
											</div>
											<div class="row" id="filter-screenshot" style="display: none;">
												<div class="col-xl-6 col-lg-6 col-sm-6">
													<h6>Filter Screenshots</h6>
												</div>
												<div class="col-xl-6 col-lg-6 col-sm-6">
													<div class="float-right">
														<button class="btn btn-dark mb-2 mr-2 rounded-circle bs-tooltip" title="Toggle Full Screen" onclick="fullScreenDiv('#screenshot-div', '#fullscreenButton')" id="fullscreenButton"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-maximize"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path></svg></button>
													</div>
												</div>
												<div class="col-xl-2 col-lg-4 col-sm-12">
													<p>HTTP Status</p>
													<select class="form-control tagging" id="http_select_filter" multiple="multiple">
													</select>
												</div>
												<div class="col-xl-2 col-lg-4 col-sm-12">
													<p>IP Address</p>
													<select class="form-control tagging" id="ips_select_filter" multiple="multiple">
													</select>
												</div>
												{% if history.port_scan %}
												<div class="col-xl-2 col-lg-4 col-sm-12">
													<p>Running Services</p>
													<select class="form-control tagging" id="services_select_filter" multiple="multiple">
													</select>
												</div>
												<div class="col-xl-2 col-lg-4 col-sm-12">
													<p>Ports</p>
													<select class="form-control tagging" id="ports_select_filter" multiple="multiple">
													</select>
												</div>
												{% endif %}
												<div class="col-xl-2 col-lg-4 col-sm-12">
													<p>Technology</p>
													<select class="form-control tagging" id="tech_select_filter" multiple="multiple">
													</select>
												</div>
											</div>
										</div>
										<div class="col-xl-12 col-lg-12 col-sm-12">
											<div class="gridzy">
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						{% endif %}
						{% if history.dir_file_search %}
						<div class="tab-pane fade" id="pills-directories" role="tabpanel" aria-labelledby="pills-directories-tab">
							<div class="col-xl-12 col-lg-12 col-sm-12">
								<div class="widget widget-content widget-content-area br-6">
									<table id="directories-table" class="table dt-table-hover" style="width:100%">
										<thead>
											<tr>
												<th class="checkbox-column">Status</th>
												<th>Subdomain</th>
												<th>Status</th>
												<th>Page Title</th>
												<th>Directories</th>
												<th>HTTP URL</th>
												<th>Is Intereting</th>
												<th>Checked</th>
											</tr>
										</thead>
									</table>
								</div>
							</div>
						</div>
						{% endif %}
						<div class="tab-pane fade" id="pills-endpoints" role="tabpanel" aria-labelledby="pills-endpoints-tab">
							<div class="row justify-content-center">
								<div class="col-xl-8 col-lg-8 col-sm-8">
									<div class="wrapper">
										<div class="search-input" id="endpoint-search-input">
											<a href="" target="_blank" hidden></a>
											<div class="input-group">
												<input type="text" class="form-control" placeholder="Filter Endpoints" aria-label="Filter Endpoints" id="endpoints-search">
												<div class="input-group-append">
													<button id="endpoint-search-button" class="btn btn-primary" type="button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg> Search</button>
												</div>
											</div>
											<div class="autocom-box mt-container mx-auto" id="autocom-box">
											</div>
										</div>
									</div>
								</div>
								<div class="col-xl-12 col-lg-12 col-sm-12">
									<div class="widget widget-content widget-content-area br-6">
										<div class="row">
											<div class="col-12">
												<div class="task-action float-right mb-4">
													<div class="dropdown">
														<a class="dropdown-toggle bs-tooltip" title="Download Results" href="#" role="button" id="pendingTask" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
															<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-download"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
														</a>
														<div class="dropdown-menu dropdown-menu-right" aria-labelledby="pendingTask" style="will-change: transform;">
															<a class="dropdown-item" href="javascript:download_endpoints({{scan_history_id}}, '{{history.domain.name}}')">Download All Endpoints</a>
															{% if history.fetch_url and history.used_gf_patterns%}
															{% for key,value in matched_gf_count.items %}
															{% if value > 0 %}
															<a class="dropdown-item" href="javascript:download_endpoints({{scan_history_id}}, '{{history.domain.name}}', '{{key}}')">Download Endpoints with pattern {{key|upper}}</a>
															{% endif %}
															{% endfor %}
															{% endif %}
														</div>
													</div>
												</div>
											</div>
											<div class="col-12">
												<table class="multi-table table table-striped table-bordered table-hover" style="width:100%" id="endpoint_results">
													<thead>
														<tr>
															<th>ID</th>
															<th>HTTP URL</th>
															<th>Status</th>
															<th>Page Title</th>
															<th>Tags</th>
															<th>Content Type</th>
															<th>Content Length</th>
															<th>Technology</th>
															<th>Webserver</th>
															<th>Response time</th>
														</tr>
													</thead>
												</table>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						{% if history.vulnerability_scan %}
						<div class="tab-pane fade" id="pills-vulnerabilities" role="tabpanel" aria-labelledby="pills-vulnerabilities-tab">
							<div class="row justify-content-center">
								<div class="col-xl-8 col-lg-8 col-sm-8">
									<div class="wrapper">
										<div class="search-input" id="vulnerability-search-input">
											<a href="" target="_blank" hidden></a>
											<div class="input-group">
												<input type="text" class="form-control" placeholder="Filter Vulnerabilities" aria-label="Filter Vulnerabilities" id="vulnerability-search">
												<div class="input-group-append">
													<button id="vulnerability-search-button" class="btn btn-primary" type="button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg> Search</button>
												</div>
											</div>
											<div class="autocom-box mt-container mx-auto" id="autocom-box">
											</div>
										</div>
									</div>
								</div>
								<div class="col-xl-12 col-lg-12 col-sm-12">
									<div class="widget">
										<div class="widget-content">
											<table class="multi-table table table-striped table-bordered table-hover non-hover" style="width:100%" id="vulnerability_results">
												<thead>
													<tr>
														<th class="checkbox-column">Status</th>
														<th>Title</th>
														<th class="text-center">Severity</th>
														<th>Vulnerable URL</th>
														<th>Description</th>
														<th>Status</th>
														<th>Matcher Name</th>
														<th>Discovered Date</th>
														<th>Tags</th>
														<th>Description</th>
														<th>Reference</th>
														<th class="text-center dt-no-sorting">Action</th>
													</tr>
												</thead>
											</table>
										</div>
									</div>
								</div>
							</div>
						</div>
						{% endif %}
						{% if history.osint %}
						<div class="tab-pane fade" id="pills-osint" role="tabpanel" aria-labelledby="pills-osint-tab">
							<div class="row">
								<div class="col-xl-5 col-lg-2 col-md-12 col-sm-12 col-12 layout-spacing">
									<div class="widget widget-activity-five">
										<div class="widget-heading">
											<h6 class=""><span id="employees-count"><span class="spinner-border text-dark align-self-center loader-sm"></span></span> Employees/People associated with {{history.domain.name}}</h6>
										</div>
										<div class="widget-content">
											<div class="w-shadow-top"></div>
											<div class="mt-container mx-auto ps ps--active-y">
												<div class="table-responsive">
													<table class="table">
														<thead>
															<tr>
																<th><div class="th-content">Employee Name</div></th>
																<th><div class="th-content">Designation</div></th>
															</tr>
														</thead>
														<tbody id="employees-table-body">
														</tbody>
													</table>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="col-xl-7 col-lg-2 col-md-12 col-sm-12 col-12 layout-spacing">
									<div class="widget widget-activity-five">
										<div class="widget-heading">
											<h6 class=""><span id="emails-count"><span class="spinner-border text-dark align-self-center loader-sm"></span></span> Discovered Email addresses <span id="exposed_summary" class="text-danger"></span></h6>
										</div>
										<div class="widget-content">
											<div class="w-shadow-top"></div>
											<div class="mt-container mx-auto ps ps--active-y">
												<div class="table-responsive">
													<table class="table">
														<thead>
															<tr>
																<th><div class="th-content">Email Address</div></th>
																<th><div class="th-content">Esposed Credentials</div></th>
															</tr>
														</thead>
														<tbody id="email-table-body">
														</tbody>
													</table>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="col-xl-4 col-lg-4 col-md-12 col-sm-12 col-12 layout-spacing">
									<div class="widget widget-activity-five">
										<div class="widget-heading">
											<h6 class=""><span id="metadata-count"><span class="spinner-border text-dark align-self-center loader-sm"></span></span> Discovered Metadata</h6>
										</div>
										<div class="widget-content">
											<div class="w-shadow-top"></div>
											<div class="mt-container mx-auto ps ps--active-y">
												<div class="table-responsive">
													<table class="table">
														<thead>
															<tr>
																<th><div class="th-content">Document</div></th>
																<th><div class="th-content text-center">User</div></th>
																<th><div class="th-content text-center">Metadata</div></th>
															</tr>
														</thead>
														<tbody id="metadata-table-body">
														</tbody>
													</table>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="col-xl-8 col-lg-8 col-md-12 col-sm-12 col-12 layout-spacing">
									<div class="widget widget-activity-five">
										<div class="widget-heading">
											<h6 class=""><span id="dorks-count"><span class="spinner-border text-dark align-self-center loader-sm"></span></span> Dork Data</h6>
										</div>
										<div class="widget-content">
											<div class="w-shadow-top"></div>
											<div id="osint-categories-badge" class="mt-3 mb-3">
											</div>
											<div class="mt-container mx-auto ps ps--active-y">
												<div class="table-responsive">
													<table class="table">
														<thead>
															<tr>
																<th><div class="th-content text-center">Dork Type</div></th>
																<th><div class="th-content text-center">Description</div></th>
																<th><div class="th-content">URL</div></th>
															</tr>
														</thead>
														<tbody id="dorks-table-body">
														</tbody>
													</table>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						{% endif %}
						<div class="tab-pane fade" id="pills-visualisation" role="tabpanel" aria-labelledby="pills-visualisation-tab">
							<div class="row">
								<div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 layout-spacing">
									<div class="statbox widget box box-shadow">
										<div class="widget-header">
											<div class="col-xl-12 col-md-12 col-sm-12 col-12">
												<div id="visualisation-filter" style="display:none">
													<div class="n-chk">
														<label class="new-control new-checkbox new-checkbox-rounded new-checkbox-text checkbox-info">
															<input type="checkbox" class="new-control-input" name="expand-nodes-checkbox">
															<span class="new-control-indicator"></span><span class="new-chk-content">&nbsp; &nbsp; Expand all nodes
															</span>
														</label>
													</div>
												</div>
												<hr>
												<div class="outer-div" id="visualisation-loader">
													<div class="spinner-border text-info align-self-center inner-div">Loading...</div>
													<br>
													<h5 class="text-center mt-3">Loading Recon Visualization...</h5>
												</div>
											</div>
										</div>
										<div class="widget-content">
											<div id="visualisation" style="height: 800px; ">
											</div>
											<div class="float-right m-3">
												<small class="text-success text-right"style="display: block;">*Subdomains highlighted with green are 20X (OK) HTTP status</small>
												<small class="text-warning text-right"style="display: block;">*Subdomains highlighted with orange are 30X (Redirect) HTTP status</small>
												<small class="text-danger text-right" style="display: block;">*Subdomains highlighted with red are 40X (Not found) HTTP status</small>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	{# modal #}
	<div class="modal fade" id="addSubdomainTaskModal" tabindex="-1" role="dialog" aria-labelledby="addSubdomainTaskModal" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-body">
					<div class="compose-box">
						<div class="compose-content" id="addTaskModalTitle">
							<h5 class="">Add Todo for <span id="todo-modal-subdomain-name"></span></h5>
							<form>
								<div class="row">
									<div class="col-md-12">
										<div class="d-flex mail-to mb-4">
											<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-3 flaticon-notes"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>
											<div class="w-100">
												<input id="subdomainTodoTitle" type="text" placeholder="Todo Title" class="form-control" name="task">
											</div>
										</div>
									</div>
								</div>

								<div class="d-flex  mail-subject mb-4">
									<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text flaticon-menu-list"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
									<div class="w-100">
										<textarea class="form-control" id="subdomainTodoDescription" rows="5" spellcheck="false" placeholder="Recon Todo/Note"></textarea>
									</div>
								</div>
							</form>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button class="btn btn-primary" id="add-todo-subdomain-submit-button">Add Recon Todo</button>
				</div>
			</div>
		</div>
	</div>
</div>
</div>
{% include 'base/_items/tab_modal.html' %}
{% endblock main_content %}

{% block page_level_script %}
<script src="{% static 'note/js/todo.js' %}"></script>
<script src="{% static 'custom/todo.js' %}"></script>
<script src="{% static 'startScan/js/datatables-suggestions.js' %}"></script>
<script src="{% static 'startScan/js/endpoint-datatables-suggestions.js' %}"></script>
{% if history.vulnerability_scan %}
<script src="{% static 'startScan/js/vulnerability-datatables-suggestions.js' %}"></script>
{% endif %}
<script src="{% static 'plugins/table/datatable/datatables.js' %}"></script>
<script src="//cdn.datatables.net/1.10.16/js/dataTables.bootstrap4.min.js"></script>
<script src="{% static 'plugins/lightbox/js/lightbox.js' %}"></script>
<script src="{% static 'plugins/apex/apexchart.min.js' %}"></script>
<script src="{% static 'plugins/select2/select2.min.js' %}"></script>
<script src="{% static 'assets/js/dashboard/dash_1.js' %}"></script>
<script src="{% static 'assets/js/ui-accordions.js' %}"></script>
<script src="{% static 'assets/js/clipboard/clipboard.min.js' %}"></script>
<script src="{% static 'custom/custom.js' %}"></script>
<script src="{% static 'custom/mitch.js' %}"></script>
<script src="{% static 'startScan/js/detail_scan.js' %}"></script>
<script src="{% static 'plugins/sweetalerts/sweetalert2.min.js' %}"></script>
<script src="{% static 'plugins/sweetalerts/custom-sweetalert.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js"></script>

<script type="text/javascript">
$('#todoSubdomainDropdown').select2({
	dropdownParent: $('#addTaskModal')
});

$("#pills-subdomain-tab").click(function() {
	var subdomain_datatables = $('#subdomain_scan_results').DataTable({
		"destroy": true,
		"processing": true,
		"oLanguage": {
			"oPaginate": { "sPrevious": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>', "sNext": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>' },
			"sInfo": "Showing page _PAGE_ of _PAGES_",
			"sLengthMenu": "Results :  _MENU_",
			"sProcessing": "Processing... Please wait..."
		},
		"stripeClasses": [],
		"lengthMenu": [50, 100, 500, 1000],
		"pageLength": 50,
		'serverSide': true,
		"ajax": '/api/listDatatableSubdomain/?scan_id={{scan_history_id}}&format=datatables',
		"order": [[ 8, "desc" ]],
		"columns": [
			{'data': 'id'},
			{'data': 'name'},
			{'data': 'endpoint_count'},
			{'data': 'endpoint_count'},
			{'data': 'http_status'},
			{'data': 'page_title'},
			{'data': 'ip_addresses'},
			{'data': 'ip_addresses'},
			{'data': 'content_length', 'searchable': false},
			{'data': 'screenshot_path', 'searchable': false},
			{'data': 'response_time'},
			{'data': 'technologies'},
			{'data': 'checked'},
			{'data': 'http_url'},
			{'data': 'cname'},
			{'data': 'is_interesting'},
			{'data': 'info_count'},
			{'data': 'low_count'},
			{'data': 'medium_count'},
			{'data': 'high_count'},
			{'data': 'critical_count'},
			{'data': 'todos_count'},
			{'data': 'is_important'},
			{'data': 'webserver'},
			{'data': 'content_type'},
		],
		"columnDefs": [
			{ "orderable": false, "targets": [2, 3, 6, 7, 9]},
			{
				"targets": [ 2, 3, 12, 14, 15, 16, 17, 18, 19, 20, 21, 22],
				"visible": false,
				"searchable": false,
			},
			{
				"targets": [ 11, 13, 22, 23, 24 ],
				"visible": false,
				"searchable": true,
			},
			{"className": "text-center", "targets": [2, 3, 4, 8, 10]},
			// checkbox
			{
				"render": function ( data, type, row ) {
					if(row['checked']){
						return `<label class="new-control new-checkbox checkbox-outline-info m-auto">
						<input type="checkbox" class="new-control-input child-chk select-customers-info" checked onchange="subdomain_status_change(this, `+data+`);">
						<span class="new-control-indicator"></span><span style="visibility:hidden">c</span>
						</label>`;
					}
					else{
						return `<label class="new-control new-checkbox checkbox-outline-info m-auto">
						<input type="checkbox" class="new-control-input child-chk select-customers-info" onchange="subdomain_status_change(this, `+data+`);">
						<span class="new-control-indicator"></span><span style="visibility:hidden">c</span>
						</label>`;
					}
				},
				"targets": 0,
			},
			// subdomain Name
			{
				"render": function ( data, type, row ) {
					badges = '';
					tech_badge = '';
					interesting_badge = '';
					content_type = '';
					web_server = '';
					if (row['technologies']){
						tech_badge = `</br>` + parse_technology(row['technologies'], "info", outline=true, scan_id={{scan_history_id}});
					}
					if(row['is_interesting'])
					{
						interesting_badge = "<span class='m-1 badge badge-pills badge-danger'>Interesting</span>"
					}

					if (row['content_type']) {
						content_type = `<span class='m-1 badge badge-pills outline-badge-warning bs-tooltip' title="Content Type">${row['content_type']}</span>`;
					}

					if (row['webserver']) {
						web_server = `<span class='m-1 badge badge-pills outline-badge-secondary bs-tooltip' title="Web Server">${row['webserver']}</span>`;
					}

					badges =   interesting_badge + '</br>';

					todo_icon = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#e7515a" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>`;
					todo_badge = '';

					if (row['todos_count']) {
						todo_badge = `<span class="text-danger badge badge-link outline-badge-danger m-1" onclick="list_subdomain_todos(${row['id']}, '${row['name']}')">${todo_icon}&nbsp;${row['todos_count']} Todos&nbsp;</span>`
					}

					important_badge = '';
					if (row['is_important']) {
						important_badge = `
						<span id="important_subdomain_${row['id']}" class="text-danger bs-tooltip" title="Important Subdomain">
						<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-alert-triangle"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
						</span>
						`;
					}

					endpoint_count_badge = '';
					if (row['endpoint_count']) {
						endpoint_count_badge = `<span class="pl-2 pr-2 ml-1 mr-1 float-right badge badge-pills badge-primary badge-link bs-tooltip" title="Endpoints" onclick="get_endpoint_modal({{history.id}}, '${row['name']}')">${row['endpoint_count']}</span>`
					}

					vuln_count_badge = '';
					info_badge = `<span class='pl-2 pr-2 ml-1 mr-1 float-right badge badge-pills badge-info bs-tooltip badge-link' title="Informational Vulnerabilities" onclick="get_vulnerability_modal({{history.id}}, 0, '${row['name']}')">${row['info_count']}</span>`;
					low_badge = `<span class='pl-2 pr-2 ml-1 mr-1 float-right badge badge-pills badge-low bs-tooltip badge-link' title=" Low Severity Vulnerabilities" onclick="get_vulnerability_modal({{history.id}}, 1, '${row['name']}')">${row['low_count']}</span>`;
					medium_badge = `<span class='pl-2 pr-2 ml-1 mr-1 float-right badge badge-pills badge-warning bs-tooltip badge-link' title="Medium Severity Vulnerabilities" onclick="get_vulnerability_modal({{history.id}}, 2, '${row['name']}')">${row['medium_count']}</span>`;
					high_badge = `<span class='pl-2 pr-2 ml-1 mr-1 float-right badge badge-pills badge-danger bs-tooltip badge-link' title="High Severity Vulnerabilities" onclick="get_vulnerability_modal({{history.id}}, 3, '${row['name']}')">${row['high_count']}</span>`;
					critical_badge = `<span class='pl-2 pr-2 ml-1 mr-1 float-right badge badge-pills badge-critical bs-tooltip badge-link' title="Critical Vulnerabilities" onclick="get_vulnerability_modal({{history.id}}, 4, '${row['name']}')">${row['critical_count']}</span>`;
					vuln_count_badge =  (row['info_count'] > 0? info_badge : '') + (row['low_count'] > 0? low_badge : '') + (row['medium_count'] > 0? medium_badge : '') + (row['high_count'] > 0? high_badge : '') + (row['critical_count'] > 0? critical_badge : '');

					action_icons = `
					<br />
					<div class="float-left subdomain-table-action-icons mt-2">
					<span class="m-1">
					<a href="javascript:;" data-clipboard-action="copy" class="badge-link text-info copyable text-primary" data-toggle="tooltip" data-placement="top" title="Copy Subdomain!" data-clipboard-target="#subdomain-${row['id']}">
					<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-copy"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></span>
					</a>
					<span class="m-1 badge-link text-success bs-tooltip" title="Add Recon Todo/Note" onclick="add_task_for_subdomain(${row['id']}, '${data}')"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus-circle"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg></span>
					<span class="m-1 badge-link text-danger bs-tooltip" title="Mark Important" onclick="mark_important_subdomain(${row['id']})">
					<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-star"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>
					</span>
					</div>
					`;

					tech_badge += content_type;
					tech_badge += web_server;

					if (row['http_url']) {
						if (row['cname']) {
							return badges + `<div class="clipboard copy-txt"><a href="`+row['http_url']+`" class="text-info" target="_blank"><span id='subdomain-${row['id']}'>`+ important_badge + data  +`</span></a>`+ endpoint_count_badge + vuln_count_badge +`<br><span class="text-dark">CNAME<br><span class="text-warning"> ❯ </span>` + row['cname'].replace(',', '<br><span class="text-warning"> ❯ </span>') + tech_badge + todo_badge + action_icons + `</div>`;
						}
						return badges + `<div class="clipboard copy-txt"><a href="`+row['http_url']+`" class="text-info" target="_blank"><span id='subdomain-${row['id']}'>`+ important_badge + data + `</span></a>` + endpoint_count_badge + vuln_count_badge + tech_badge + todo_badge + action_icons + `</div>`;
					}
					return badges + `<div class="clipboard copy-txt"><a href="https://`+data+`" class="text-info" target="_blank"><span id='subdomain-${row['id']}'>`+ important_badge + data + `</span></a>` + endpoint_count_badge + vuln_count_badge + tech_badge + todo_badge + action_icons + `</div>`;
				},
				"targets": 1
			},
			// http_status
			{
				"render": function ( data, type, row ) {
					// display badge based on http status
					// green for http status 2XX, orange for 3XX and warning for everything else
					if (data >= 200 && data < 300) {
						return "<span class='badge badge-pills badge-success'>"+data+"</span>";
					}
					else if (data >= 300 && data < 400) {
						return "<span class='badge badge-pills badge-warning'>"+data+"</span>";
					}
					else if (data == 0){
						// datatable throws error when no data is returned
						return "";
					}
					return `<span class='badge badge-pills badge-danger'>`+data+`</span>`;
				},
				"targets": 4,
			},
			// page title
			{
				"render": function ( data, type, row ) {
					if (data){
						return htmlEncode(data);
					}
					return "";
				},
				"targets": 5,
			},
			// ip address
			{
				"render": function ( data, type, row ) {
					ip_badge = ''
					if (data)
					{
						Object.entries(data).forEach(([key, value]) => {
							if (value['is_cdn']) {
								ip_badge += `<span class='m-1 badge badge-pills outline-badge-warning badge-link' title="CDN IP Address" onclick="get_ip_details('${value.address}', {{scan_history_id}})">${value.address}</span>`
							}
							else{
								ip_badge += `<span class='m-1 badge badge-pills outline-badge-info badge-link' onclick="get_ip_details('${value.address}', {{scan_history_id}})">${value.address}</span>`
							}
						});
						return ip_badge;
					}
					return "";
				},
				"targets": 6,
			},
			// open ports
			{
				"render": function ( data, type, row ) {
					port_badge = ''
					if (data){
						for (ip in data){
							ports = data[ip]['ports']
							for (port in ports){
								port_obj = data[ip]['ports'][port]
								badge_color = port_obj['is_uncommon'] ? 'danger' : 'info';
								title = port_obj['is_uncommon'] ? 'Uncommon Port - ' + port_obj['description'] : port_obj['description'];
								port_badge += `<span class='m-1 badge badge-pills outline-badge-${badge_color} bs-tooltip badge-link' title='${title}' onclick="get_port_details(${port_obj['number']}, {{scan_history_id}})">${port_obj['number']}/${port_obj['service_name']}</span>`
							}
						}
						return port_badge;
					}
					return "";
				},
				"targets": 7,
			},
			// screenshot
			{
				"render": function ( data, type, row ) {
					if (data){
						//return lightbox with caption as http link
						return `<a href="/media/`+data+`" data-lightbox="screenshots" data-title="&lt;a target='_blank' href='`+row['http_url']+`'&gt;&lt;h3 style=&quot;color:white&quot;&gt;`+row['name']+`&lt;/h3&gt;&lt;/a&gt;"><img src="/media/`+data+`" class="img-fluid rounded mb-4 mt-4 screenshot" onerror="removeImageElement(this)"></a>`;
					}
					return "";
				},
				"targets": 9,
			},
			// response_time
			{
				"render": function ( data, type, row ) {
					if (data){
						return get_response_time_text(data);
					}
					return "";
				},
				"targets": 10,
			},
		],
		"dom": "<'row'<'col-lg-12 col-md-12 col-12 mb-2'l>>" +
		"<<'col'tr>>" +
		"<'dt--bottom-section d-sm-flex justify-content-sm-between text-center'<'dt--pages-count  mb-sm-0 mb-3'i><'dt--pagination'p>>",
		drawCallback: function () {
			$('.t-dot').tooltip({ template: '<div class="tooltip status" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>' })
			$('.badge').tooltip({ template: '<div class="tooltip status" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>' })
			$('.bs-tooltip').tooltip();
			// get screenshot size from localStorage
			var elements = document.getElementsByClassName("screenshot");
			screenshot_size = localStorage.getItem('screenshotSize');
			if (screenshot_size){
				for (index = 0; index < elements.length; ++index) {
					elements[index].setAttribute("height", screenshot_size);
					elements[index].setAttribute("width", screenshot_size);
				}
			}
			else{
				for (index = 0; index < elements.length; ++index) {
					elements[index].setAttribute("height", "200px");
					elements[index].setAttribute("width", "200px");
				}
			}
		},
		'createdRow': function( row, data, dataIndex ) {
			if (data['checked']){
				$(row).addClass('table-secondary text-strike');
			}
		},
	});

	$('#subdomain-search-button').click(function () {
		subdomain_datatables.search($("#subdomains-search").val()).draw() ;
	});

});

{% if history.dir_file_search %}
$("#pills-directories-tab").click(function() {
	var history_table = $('#directories-table').DataTable({
		"destroy": true,
		"oLanguage": {
			"oPaginate": { "sPrevious": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>', "sNext": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>' },
			"sInfo": "Showing page _PAGE_ of _PAGES_",
			"sSearch": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>',
			"sLengthMenu": "Results :  _MENU_",
			"sProcessing": "Processing... Please wait..."
		},
		"processing": true,
		"stripeClasses": [],
		"lengthMenu": [20, 50, 100, 500, 1000],
		"pageLength": 20,
		'serverSide': true,
		"ajax": '/api/listDatatableSubdomain/?scan_id={{scan_history_id}}&format=datatables&only_diretory',
		"order": [[ 5, "desc" ]],
		"columns": [
			{'data': 'id'},
			{'data': 'name'},
			{'data': 'http_status'},
			{'data': 'page_title'},
			{'data': 'directory_json'},
			{'data': 'http_url'},
			{'data': 'is_interesting'},
			{'data': 'checked'},
		],
		"columnDefs": [
			{
				"targets": [ 5, 6, 7],
				"visible": false,
				"searchable": false,
			},
			{
				"render": function ( data, type, row ) {
					if(row['checked']){
						return `<label class="new-control new-checkbox checkbox-outline-info m-auto">
						<input type="checkbox" class="new-control-input child-chk select-customers-info" checked onchange="subdomain_status_change(this, `+data+`);">
						<span class="new-control-indicator"></span><span style="visibility:hidden">c</span>
						</label>`;
					}
					else{
						return `<label class="new-control new-checkbox checkbox-outline-info m-auto">
						<input type="checkbox" class="new-control-input child-chk select-customers-info" onchange="subdomain_status_change(this, `+data+`);">
						<span class="new-control-indicator"></span><span style="visibility:hidden">c</span>
						</label>`;
					}
				},
				"targets": 0,
			},
			{
				"render": function ( data, type, row ) {
					if (row['http_url']) {
						interesting_badge = '';
						if(row['is_interesting'])
						{
							interesting_badge = "&nbsp;<span class='badge badge-pills badge-danger'>Interesting</span>&nbsp;"
						}
						return `<a href="`+row['http_url']+`" class="text-info" target="_blank">`+data+`</a>`+interesting_badge+`<br>`;
					}
					return `<a href="https://`+data+`" class="text-info" target="_blank">`+data+`</a>` + interesting_badge;
				},
				"targets": 1
			},
			{
				"render": function ( data, type, row ) {
					// display badge based on http status
					// green for http status 2XX, orange for 3XX and warning for everything else
					if (data >= 200 && data < 300) {
						return "<span class='badge badge-pills badge-success'>"+data+"</span>";
					}
					else if (data >= 300 && data < 400) {
						return "<span class='badge badge-pills badge-warning'>"+data+"</span>";
					}
					else if (data == 0){
						// datatable throws error when no data is returned
						return "";
					}
					return `<span class='badge badge-pills badge-danger'>`+data+`</span>`;
				},
				"targets": 2,
			},
			{
				"render": function ( data, type, row ) {
					if (data){
						return htmlEncode(data);
					}
					return "";
				},
				"targets": 3,
			},
			{
				"render": function ( data, type, row ) {
					if (data) {
						data = JSON.parse(data)['results'];
						var html_treeview = `<ul class="file-tree">`;
						data = data[0];
						// if main url has trailing / then we need to omit, otherwise it should be okay to append path
						// preserve original url to access json object
						url = Object.keys(data)[0]
						http_url = url.substring(url.length - 1) == '/' ? url.slice(0, -1): url;
						console.log(http_url);
						var json_obj = data[url];
						for(var i = 0; i < json_obj.length; i++)
						{
							if(json_obj[i].status==200)
							{
								var path = json_obj[i].path;
								var contentlength = (json_obj[i]["content-length"]/1000).toFixed(2);
								// id path has / the its a directory else consider as file
								if (path.substr(path.length - 1) == '/') {
									html_treeview += `<li class="file-tree-empty-folder"><a href="` + http_url + path + `" target="_blank">` + path + ` (` + contentlength.toString() + ` Kb)</a></li>`;
								}
								else {
									html_treeview += `<li id='filePath'><a href="` + http_url + path + `" target="_blank">` + path + ` (` + contentlength.toString() + ` Kb)</a></li>`;
								}
							}
						}
						html_treeview += `</ul>`;
						return html_treeview;
					}
					return '';
				},
				"targets": 4,
			},
		],
		"dom": "<'row'<'col-lg-10 col-md-10 col-12'f><'col-lg-2 col-md-2 col-12'l>>" +
		"<'row'<'col'tr>>" +
		"<'dt--bottom-section d-sm-flex justify-content-sm-between text-center'<'dt--pages-count  mb-sm-0 mb-3'i><'dt--pagination'p>>",
		drawCallback: function () {
			$('.t-dot').tooltip({ template: '<div class="tooltip status" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>' })
			$('.dataTables_wrapper table').removeClass('table-striped');
			$('.badge').tooltip({ template: '<div class="tooltip status" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>' })
			$('.dataTables_wrapper table').removeClass('table-striped');
		},
		initComplete: function( settings, json ) {
			var script = document.createElement("script");
			script.src = "/staticfiles/plugins/treeview/custom-jstree.js";
			script.type = "text/javascript";
			document.getElementsByTagName("head")[0].appendChild(script);
		},
		'createdRow': function( row, data, dataIndex ) {
			if (data['checked']){
				$(row).addClass('table-secondary text-strike');
			}
		},
		"rowCallback": function( row, data, index ) {
			if (!data["directory_json"]) {
				$(row).hide();
			}
		},
	});
});
{% endif %}

{% if history.vulnerability_scan %}
$("#pills-vulnerabilities-tab").click(function() {
	var vulnerability_table = $('#vulnerability_results').DataTable({
		"destroy": true,
		"oLanguage": {
			"oPaginate": { "sPrevious": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>', "sNext": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>' },
			"sInfo": "Showing page _PAGE_ of _PAGES_",
			"sLengthMenu": "Results :  _MENU_",
			"sProcessing": "Processing... Please wait..."
		},
		"processing": true,
		"dom": "<'row'<'col-lg-12 col-md-12 col-12 mb-2'l>>" +
		"<'row'<'col'tr>>" +
		"<'dt--bottom-section d-sm-flex justify-content-sm-between text-center'<'dt--pages-count  mb-sm-0 mb-3'i><'dt--pagination'p>>",
		"stripeClasses": [],
		"lengthMenu": [20, 50, 100, 500, 1000],
		"pageLength": 20,
		'serverSide': true,
		"ajax": '/api/listVulnerability/?scan_history={{scan_history_id}}&format=datatables',
		"order": [[ 2, "desc" ]],
		"columns": [
			{'data': 'id'},
			{'data': 'name'},
			{'data': 'severity'},
			{'data': 'http_url'},
			{'data': 'extracted_results'},
			{'data': 'open_status'},
			{'data': 'matcher_name'},
			{'data': 'discovered_date'},
			{'data': 'tags'},
			{'data': 'description'},
			{'data': 'reference'},
			{'data': 'hackerone_report_id'},
		],
		"columnDefs": [
			{ "orderable": false, "targets": [4, 9, 10, 11]},
			{
				"targets": [ 6, 7, 8, 9, 10 ],
				"visible": false,
				"searchable": true,
			},
			{"className": "text-center", "targets": [0, 2, 5, 11]},
			{
				"render": function ( data, type, row ) {
					if(row['open_status']){
						return `<label class="new-control new-checkbox checkbox-outline-info m-auto">
						<input type="checkbox" class="new-control-input child-chk select-customers-info" onchange="vuln_status_change(this, `+data+`);">
						<span class="new-control-indicator"></span><span style="visibility:hidden">c</span>
						</label>`;
					}
					else{
						return `<label class="new-control new-checkbox checkbox-outline-info m-auto">
						<input type="checkbox" class="new-control-input child-chk select-customers-info" checked onchange="vuln_status_change(this, `+data+`);">
						<span class="new-control-indicator"></span><span style="visibility:hidden">c</span>
						</label>`;
					}
				},
				"targets": 0,
			},
			{
				"render": function ( data, type, row ) {
					var tags_span ="";
					switch (row['severity']) {
						case 'Info':
						color = 'info'
						break;
						case 'Low':
						color = 'low'
						break;
						case 'Medium':
						color = 'warning'
						break;
						case 'High':
						color = 'danger'
						break;
						case 'Critical':
						color = 'critical'
						break;
						default:
					}
					if (row['tags']) {
						var badge = "<span class='badge badge-pill outline-badge-"+color+" m-1'>";
						row['tags'].split(/\s*,\s*/).forEach(function(split_vals) {
							tags_span+=badge + split_vals + "</span>";
						});
					}
					hackerone_report = row['hackerone_report_id'] ? `<br><a class="badge outline-badge-danger m-2" href="https://hackerone.com/reports/${row['hackerone_report_id']}" target="_blank">Reported to hackerone</a>` : "";
					return `<b class="text-${color}">` + data + `</b>` + `<br/>` + tags_span + hackerone_report + `<br><small>Last Seen:` + row['discovered_date'] + "</small>";
				},
				"targets": 1,
			},
			{
				"render": function ( data, type, row ) {
					switch (data) {
						case 'Info':
						return "<span class='badge badge-info'>Info</span>";
						break;
						case 'Low':
						return "<span class='badge badge-low'>Low</span>";
						break;
						case 'Medium':
						return "<span class='badge badge-warning'>Medium</span>";
						break;
						case 'High':
						return "<span class='badge badge-danger'>High</span>";
						break;
						case 'Critical':
						return "<span class='badge badge-critical'>Critical</span>";
						break;
						default:
						return "";
					}
				},
				"targets": 2,
			},

			{
				"render": function ( data, type, row ) {
					return "<a href='"+htmlEncode(data)+"' target='_blank' class='text-danger'>"+htmlEncode(data)+"</a>";
				},
				"targets": 3,
			},
			{
				"render": function ( data, type, row ) {
					extracted_results = row['extracted_results'] ? row['extracted_results'] + `</br>` : "";
					matcher_name = row['matcher_name'] ? row['matcher_name'] + `</br>` : "";
					description = row['description'] ? row['description'] + `</br>` : "";
					reference = row['reference'] ? `<a href=${row['reference']} class='text-info' target='_blank'>Read More...</a>` : "";
					return extracted_results + matcher_name + description + reference;
				},
				"targets": 4,
			},
			{
				"render": function ( data, type, row ) {
					if (data){
						return '<div class="t-dot bg-danger" data-toggle="tooltip" data-placement="top" title="" data-original-title="Open"></div>'
					}
					else{
						return '<div class="t-dot bg-success" data-toggle="tooltip" data-placement="top" title="" data-original-title="Closed"></div>'
					}
				},
				"targets": 5,
			},
			{
				"render": function ( data, type, row ) {
					if (!data){
						return `<div class="dropdown">
						<a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink${row['id']}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-more-horizontal"><circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle><circle cx="5" cy="12" r="1"></circle></svg>
						</a>
						<div class="dropdown-menu" aria-labelledby="dropdownMenuLink6">
						<a class="dropdown-item" href="javascript:report_hackerone(${row['id']}, '${row['severity']}');">Report to Hackerone</a>
						</div>
						</div>`;
					}
					else{
						return '';
					}
				},
				"targets": 11,
			},
		],
		drawCallback: function () {
			$('.t-dot').tooltip({ template: '<div class="tooltip status" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>' })
			$('.dataTables_wrapper table').removeClass('table-striped');
		},
		createdRow: function( row, data, dataIndex ) {
			if (!data['open_status']){
				$(row).addClass('table-secondary text-strike');
			}
		},
	});
	$('#vulnerability-search-button').click(function () {
		vulnerability_table.search($('#vulnerability-search').val()).draw() ;
	});
});
{% endif %}

// clipboard

var clipboard = new Clipboard('.copyable');
clipboard.on('success', function(e) {
	setTooltip(e.trigger, 'Copied!');
	hideTooltip(e.trigger);
});

// apex charts for vulnerability summary
var options = {
	chart: {
		type: 'donut',
		width: 355
	},
	colors: ['#D50000', '#F44336', '#FF6D00', '#FFD600', '#2962FF'],
	dataLabels: {
		enabled: false
	},
	legend: {
		position: 'bottom',
		horizontalAlign: 'center',
		fontSize: '14px',
		markers: {
			width: 10,
			height: 10,
		},
		itemMargin: {
			horizontal: 0,
			vertical: 8
		}
	},
	plotOptions: {
		pie: {
			donut: {
				size: '65%',
				background: 'transparent',
				labels: {
					show: true,
					name: {
						show: true,
						fontSize: '29px',
						fontFamily: 'Nunito, sans-serif',
						color: undefined,
						offsetY: -10
					},
					value: {
						show: true,
						fontSize: '26px',
						fontFamily: 'Nunito, sans-serif',
						color: '20',
						offsetY: 16,
						formatter: function (val) {
							return val
						}
					},
					total: {
						show: true,
						showAlways: true,
						label: 'Total',
						color: '#888ea8',
						formatter: function (w) {
							return w.globals.seriesTotals.reduce( function(a, b) {
								return a + b
							}, 0)
						}
					}
				}
			}
		}
	},
	series: [{{critical_count}}, {{high_count}}, {{medium_count}}, {{low_count}}, {{info_count}}],
	labels: ['Critical', 'High', 'Medium', 'Low', 'Info']
}

var chart = new ApexCharts(
	document.querySelector("#vulnerability-chart"),
	options
);

chart.render();

function subdomain_status_change(checkbox, id)
{
	if (checkbox.checked) {
		checkbox.parentNode.parentNode.parentNode.className = "table-secondary text-strike";
	}
	else {
		checkbox.parentNode.parentNode.parentNode.classList.remove("table-secondary");
		checkbox.parentNode.parentNode.parentNode.classList.remove("text-strike");
	}
	change_subdomain_status(id);
}

// default get urls
$("#pills-endpoints-tab").click(function() {
	get_endpoints({{scan_history_id}}, null);
});

//get subdomain changes
get_subdomain_changes({{scan_history_id}});
get_endpoint_changes({{scan_history_id}});

// get interesting subdomain
get_interesting_subdomains(null, {{scan_history_id}});
// get interesting endpoint
get_interesting_endpoint(null, {{scan_history_id}});


// get screenshots
$("#pills-screenshot-tab").click(function() {
	get_screenshot({{scan_history_id}});
	$(".tagging").select2({
		tags: true
	});
	//animate search placeholder
	const words = ["Search by Page Title   ",
	"Search by HTTP Status   ",
	"Search 'Interesting'   ",
	"Search by Subdomain Name   "]

	typingEffect(words, "screenshot-search", 0);
});


// get osint
$("#pills-osint-tab").click(function() {
	// osint
	get_metadata({{scan_history_id}});
	get_emails({{scan_history_id}});
	get_employees({{scan_history_id}});
	get_dorks({{scan_history_id}});
});

$("#pills-visualisation-tab").click(function() {
	visualise_scan_results({{scan_history_id}});
});

get_important_subdomains(null, {{scan_history_id}});

get_ips({{scan_history_id}});

get_technologies({{scan_history_id}});

get_osint_users({{scan_history_id}});

get_ports({{scan_history_id}});

get_dork_summary({{scan_history_id}});

get_recon_notes(null, {{scan_history_id}});

{% if history.fetch_url and history.used_gf_patterns %}
// gf patterns
{% for pattern in history.used_gf_patterns|split:"," %}
$("#pills-{{pattern}}-tab").click(function() {
	get_endpoints({{scan_history_id}}, '{{pattern}}');
});
{% endfor %}
{% endif %}

</script>

{% endblock page_level_script %}
